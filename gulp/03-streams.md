# Streams / Потоки

Gulp уможнює різноманітні перетворення файлів завдяки системі потоків. Потік - це послідновність об"єктів, котрі представляють відповідні файли.

```js
gulp.task('НАЗВА_ЗАВДАННЯ', function () {
  return gulp.src('ФАЙЛ(И)')
    .pipe(ПЕРЕТВОРЕННЯ_1)
    .pipe(ПЕРЕТВОРЕННЯ_2)
    ...
    .pipe(ПЕРЕТВОРЕННЯ_N);
});
```

## `gulp.src()`
Вбудований метод `.src()` приймає аргумент - правило, відповідно до якого потрібно взяти файли із вказаних директорій.

Просте оголошення правил:

```js
gulp.src('js/*.js');
```

Поєднане оголошення правил файлів:
```js
gulp.src(['js/*.js', 'css/styles.css']);
```

## Files / Файли
Щоб передати файл чи файли до потоку трансформацій, потрібно вказати відносний шлях до них. Gulp приймає шляхи файлів використовуючи [node-glob](https://github.com/isaacs/node-glob).

Розглянемо наступну файлову структуру:

```
js/
  base/
    fileA.js
  components/
    fileB.js
    fileC.js
  app.js
  fileD.js
  styles.css
```

* `js/app.js` Посилання до конкретного файлу `app.js` в папці `js`:

```
// Таргетовані файли:
js/app.js
```

* `js/*.js` Відповідає всім файлам, що знаходяться на кореневому рівні папки `js` і закінчуються на `.js`:

```
// Таргетовані файли:
js/app.js
js/fileD.js
```

* `js/**/*.js` Відповідає всім файлам формату `.js` в папці `js` і всім вкладеним в неї папкам:

```
// Таргетовані файли:
js/app.js
js/fileD.js
js/base/fileA.js
js/components/fileB.js
js/components/fileC.js
```

* `!js/app.js` Виключає даний файл із потрібних. Корисно коли потрібно взяти всі файли в папці, окрім певного файлу. Наприклад, при правилі `['js/**/*.js', '!js/app.js']` потік файлів складатиметься:

```
// Таргетовані файли:
js/fileD.js
js/base/fileA.js
js/components/fileB.js
js/components/fileC.js
```

* `js/*.+(js|css)` Відповідає всім файлам формату `.js` або `.css`, що знаходяться на кореневому рівні папки `js/`:

```
// Таргетовані файли:
js/app.js
js/styles.css
```

Можливе також поєднання декількох виразів одночано:

```js
gulp.src(['js/**/*.js', '!js/**/*.min.js']);
```

Дане оголошення відповідає всім файлам формату `.js` у папці `js/` і всім вкладеним папкам, окрім файлів із закінченням `.min.js.`

## Transformations / Перетворення
Суть перетворення це отримати файли у стані А, перетворити їх у стан Б і передати цей стан наступному перетворенню, якщо таке існує.


**Ключові моменти:**
* Ланцюг перетворень записується завдяки вбудованому методу `.pipe(ПЕРЕТВОРЕННЯ)`, де `ПЕРЕТВОРЕННЯ` це виклик функції перетворювання
* Перетворення в ланцюгу перетвореннь виконуються послідовно, одне за одним
* Якщо `ПЕРЕТВОРЕННЯ_N` викидає помилку, то `ПЕРЕТВОРЕННЯ_N+1` і наступні перетворення не відбуваються

У якості перетворень часто використовуються спеціальні плагіни, створені для роботи з Gulp, або власні функції написані відповідно до документації потоків у Gulp.

## Example / Приклад
Напишемо завдання, котре візьме файли JavaScript (`.js`), мінімізує їх та збереже у новій директорії.

```js
/* Під"єднати плагін "gulp-uglify" */
const uglify = require('gulp-uglify');

gulp.task('js', function () {
  /* Взяти кожен файл, що закінчується на ".js" у папці "js/" */
  return gulp.src('js/*.js')

    /* Пропустити кожен файл через плагін "gulp-uglify", котрий мінімізує JavaScript */
    .pipe(uglify())
    
    /* Зберегти мінімізовані файли у нову директорію */
    .pipe(gulp.dest('build/js'));
})
```
